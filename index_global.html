<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MNL - The Most Reliable Compass for Startups</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@300;400;500;600;700&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'IBM Plex Sans', 'IBM Plex Sans KR', sans-serif;
        }
        .loader {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #f59e0b;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .language-option {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .language-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .detecting {
            background: linear-gradient(90deg, #f59e0b, #d97706, #f59e0b);
            background-size: 200% 100%;
            animation: gradient 2s ease-in-out infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center">
    <!-- 언어 감지 중 화면 -->
    <div id="detecting-screen" class="text-center fade-in">
        <div class="mb-8">
            <img src="https://mnllab.github.io/mnlbiz/assets/MNL.png" alt="MNL Logo" class="h-16 w-auto mx-auto mb-6">
        </div>
        <div class="loader mx-auto mb-6"></div>
        <h2 class="text-2xl font-bold detecting mb-4">Detecting your location...</h2>
        <p class="text-gray-600 mb-8">지역을 감지하여 최적의 언어로 안내해드립니다</p>
        <button onclick="showLanguageSelector()" class="text-amber-600 hover:text-amber-700 font-medium">
            언어를 직접 선택하기 →
        </button>
    </div>

    <!-- 언어 선택 화면 -->
    <div id="language-selector" class="hidden max-w-4xl mx-auto px-6 fade-in">
        <div class="text-center mb-12">
            <img src="https://mnllab.github.io/mnlbiz/assets/MNL.png" alt="MNL Logo" class="h-16 w-auto mx-auto mb-6">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">Welcome to MNL</h1>
            <p class="text-lg text-gray-600">Please select your preferred language</p>
            <p class="text-sm text-gray-500 mt-2">언어를 선택해주세요</p>
        </div>
        
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- 한국어 -->
            <div class="language-option bg-white p-8 rounded-xl shadow-lg border-2 border-transparent hover:border-amber-500" onclick="goToLanguage('kr')">
                <div class="text-center">
                    <div class="text-4xl mb-4">🇰🇷</div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">한국어</h3>
                    <p class="text-gray-600 text-sm mb-4">창업의 가장 확실한 나침반</p>
                    <div class="bg-amber-500 text-white px-4 py-2 rounded-lg font-medium">
                        Korean
                    </div>
                </div>
            </div>

            <!-- 영어 -->
            <div class="language-option bg-white p-8 rounded-xl shadow-lg border-2 border-transparent hover:border-amber-500" onclick="goToLanguage('en')">
                <div class="text-center">
                    <div class="text-4xl mb-4">🇺🇸</div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">English</h3>
                    <p class="text-gray-600 text-sm mb-4">The Most Reliable Compass for Startups</p>
                    <div class="bg-amber-500 text-white px-4 py-2 rounded-lg font-medium">
                        English
                    </div>
                </div>
            </div>

            <!-- 일본어 -->
            <div class="language-option bg-white p-8 rounded-xl shadow-lg border-2 border-transparent hover:border-amber-500" onclick="goToLanguage('jp')">
                <div class="text-center">
                    <div class="text-4xl mb-4">🇯🇵</div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">日本語</h3>
                    <p class="text-gray-600 text-sm mb-4">起業の最も確実なコンパス</p>
                    <div class="bg-amber-500 text-white px-4 py-2 rounded-lg font-medium">
                        Japanese
                    </div>
                </div>
            </div>

            <!-- 프랑스어 -->
            <div class="language-option bg-white p-8 rounded-xl shadow-lg border-2 border-transparent hover:border-amber-500" onclick="goToLanguage('fr')">
                <div class="text-center">
                    <div class="text-4xl mb-4">🇫🇷</div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Français</h3>
                    <p class="text-gray-600 text-sm mb-4">La boussole la plus fiable pour les startups</p>
                    <div class="bg-amber-500 text-white px-4 py-2 rounded-lg font-medium">
                        French
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-8">
            <p class="text-sm text-gray-500">
                Your selection will be saved for future visits
            </p>
        </div>
    </div>

    <script>
        // 언어별 페이지 매핑
        const languagePages = {
            'kr': 'index_kr.html',
            'en': 'index_en.html', 
            'jp': 'index_jp.html',
            'fr': 'index_fr.html'
        };

        // 국가별 기본 언어 매핑
        const countryLanguageMap = {
            'KR': 'kr', // 한국
            'US': 'en', // 미국
            'GB': 'en', // 영국
            'CA': 'en', // 캐나다
            'AU': 'en', // 호주
            'NZ': 'en', // 뉴질랜드
            'IE': 'en', // 아일랜드
            'ZA': 'en', // 남아프리카
            'JP': 'jp', // 일본
            'FR': 'fr', // 프랑스
            'BE': 'fr', // 벨기에 (프랑스어권)
            'CH': 'fr', // 스위스 (프랑스어권)
            'LU': 'fr', // 룩셈부르크
            'MC': 'fr', // 모나코
            // 기타 국가는 영어를 기본으로
        };

        // 브라우저 언어별 매핑
        const browserLanguageMap = {
            'ko': 'kr',
            'ko-KR': 'kr',
            'en': 'en',
            'en-US': 'en',
            'en-GB': 'en',
            'ja': 'jp',
            'ja-JP': 'jp',
            'fr': 'fr',
            'fr-FR': 'fr',
            'fr-CA': 'fr'
        };

        // 이전 언어 선택 확인
        function getPreviousLanguageChoice() {
            return localStorage.getItem('mnl-preferred-language');
        }

        // 언어 선택 저장
        function saveLanguageChoice(lang) {
            localStorage.setItem('mnl-preferred-language', lang);
        }

        // 브라우저 언어 감지
        function detectBrowserLanguage() {
            const languages = navigator.languages || [navigator.language || navigator.userLanguage];
            
            for (let lang of languages) {
                if (browserLanguageMap[lang]) {
                    return browserLanguageMap[lang];
                }
                // 언어 코드만 확인 (예: 'ko-KR' -> 'ko')
                const shortLang = lang.split('-')[0];
                if (browserLanguageMap[shortLang]) {
                    return browserLanguageMap[shortLang];
                }
            }
            return 'en'; // 기본값
        }

        // 지역 감지 (IP 기반)
        async function detectLocation() {
            try {
                // 무료 IP 지역 감지 서비스 사용
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                
                if (data.country_code && countryLanguageMap[data.country_code]) {
                    return countryLanguageMap[data.country_code];
                }
                
                return detectBrowserLanguage();
            } catch (error) {
                console.log('위치 감지 실패, 브라우저 언어로 대체:', error);
                return detectBrowserLanguage();
            }
        }

        // 언어별 페이지로 이동
        function goToLanguage(lang) {
            if (!languagePages[lang]) {
                console.error('지원하지 않는 언어:', lang);
                lang = 'en'; // 기본값으로 변경
            }
            
            saveLanguageChoice(lang);
            
            // 페이지 이동 전 간단한 로딩 효과
            document.body.style.opacity = '0.7';
            
            setTimeout(() => {
                window.location.href = languagePages[lang];
            }, 300);
        }

        // 언어 선택 화면 표시
        function showLanguageSelector() {
            document.getElementById('detecting-screen').style.display = 'none';
            document.getElementById('language-selector').classList.remove('hidden');
        }

        // URL 파라미터에서 언어 확인
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            if (lang && languagePages[lang]) {
                return lang;
            }
            return null;
        }

        // 메인 언어 감지 및 리다이렉트 로직
        async function initLanguageDetection() {
            // 1. URL 파라미터 확인 (최우선)
            const urlLang = getLanguageFromURL();
            if (urlLang) {
                goToLanguage(urlLang);
                return;
            }

            // 2. 이전 선택 확인
            const previousChoice = getPreviousLanguageChoice();
            if (previousChoice && languagePages[previousChoice]) {
                goToLanguage(previousChoice);
                return;
            }

            // 3. 위치/브라우저 기반 감지
            try {
                const detectedLang = await detectLocation();
                
                // 3초 후 자동 리다이렉트 (사용자가 수동 선택할 시간 제공)
                setTimeout(() => {
                    // 만약 사용자가 이미 언어 선택 화면을 보고 있다면 자동 리다이렉트 취소
                    if (document.getElementById('language-selector').classList.contains('hidden')) {
                        goToLanguage(detectedLang);
                    }
                }, 3000);
                
            } catch (error) {
                console.error('언어 감지 중 오류:', error);
                // 오류 발생 시 언어 선택 화면 표시
                setTimeout(showLanguageSelector, 2000);
            }
        }

        // 페이지 로드 시 언어 감지 시작
        document.addEventListener('DOMContentLoaded', initLanguageDetection);

        // 키보드 단축키 지원
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                showLanguageSelector();
            }
            // 숫자 키로 빠른 선택
            const keyMap = {
                '1': 'kr',
                '2': 'en', 
                '3': 'jp',
                '4': 'fr'
            };
            if (keyMap[e.key] && !document.getElementById('language-selector').classList.contains('hidden')) {
                goToLanguage(keyMap[e.key]);
            }
        });
    </script>
</body>
</html>
