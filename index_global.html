<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MNL - The Most Reliable Compass for Startups</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@300;400;500;600;700&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'IBM Plex Sans', 'IBM Plex Sans KR', sans-serif;
        }
        .loader {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #f59e0b;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .language-option {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .language-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .detecting {
            background: linear-gradient(90deg, #f59e0b, #d97706, #f59e0b);
            background-size: 200% 100%;
            animation: gradient 2s ease-in-out infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center">
    <!-- ì–¸ì–´ ê°ì§€ ì¤‘ í™”ë©´ -->
    <div id="detecting-screen" class="text-center fade-in">
        <div class="mb-8">
            <img src="https://mnllab.github.io/mnlbiz/assets/MNL.png" alt="MNL Logo" class="h-16 w-auto mx-auto mb-6">
        </div>
        <div class="loader mx-auto mb-6"></div>
        <h2 class="text-2xl font-bold detecting mb-4">Detecting your location...</h2>
        <p class="text-gray-600 mb-8">ì§€ì—­ì„ ê°ì§€í•˜ì—¬ ìµœì ì˜ ì–¸ì–´ë¡œ ì•ˆë‚´í•´ë“œë¦½ë‹ˆë‹¤</p>
        <button onclick="showLanguageSelector()" class="text-amber-600 hover:text-amber-700 font-medium">
            ì–¸ì–´ë¥¼ ì§ì ‘ ì„ íƒí•˜ê¸° â†’
        </button>
    </div>

    <!-- ì–¸ì–´ ì„ íƒ í™”ë©´ -->
    <div id="language-selector" class="hidden max-w-4xl mx-auto px-6 fade-in">
        <div class="text-center mb-12">
            <img src="https://mnllab.github.io/mnlbiz/assets/MNL.png" alt="MNL Logo" class="h-16 w-auto mx-auto mb-6">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">Welcome to MNL</h1>
            <p class="text-lg text-gray-600">Please select your preferred language</p>
            <p class="text-sm text-gray-500 mt-2">ì–¸ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</p>
        </div>
        
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- í•œêµ­ì–´ -->
            <div class="language-option bg-white p-8 rounded-xl shadow-lg border-2 border-transparent hover:border-amber-500" onclick="goToLanguage('kr')">
                <div class="text-center">
                    <div class="text-4xl mb-4">ğŸ‡°ğŸ‡·</div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">í•œêµ­ì–´</h3>
                    <p class="text-gray-600 text-sm mb-4">ì°½ì—…ì˜ ê°€ì¥ í™•ì‹¤í•œ ë‚˜ì¹¨ë°˜</p>
                    <div class="bg-amber-500 text-white px-4 py-2 rounded-lg font-medium">
                        Korean
                    </div>
                </div>
            </div>

            <!-- ì˜ì–´ -->
            <div class="language-option bg-white p-8 rounded-xl shadow-lg border-2 border-transparent hover:border-amber-500" onclick="goToLanguage('en')">
                <div class="text-center">
                    <div class="text-4xl mb-4">ğŸ‡ºğŸ‡¸</div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">English</h3>
                    <p class="text-gray-600 text-sm mb-4">The Most Reliable Compass for Startups</p>
                    <div class="bg-amber-500 text-white px-4 py-2 rounded-lg font-medium">
                        English
                    </div>
                </div>
            </div>

            <!-- ì¼ë³¸ì–´ -->
            <div class="language-option bg-white p-8 rounded-xl shadow-lg border-2 border-transparent hover:border-amber-500" onclick="goToLanguage('jp')">
                <div class="text-center">
                    <div class="text-4xl mb-4">ğŸ‡¯ğŸ‡µ</div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">æ—¥æœ¬èª</h3>
                    <p class="text-gray-600 text-sm mb-4">èµ·æ¥­ã®æœ€ã‚‚ç¢ºå®Ÿãªã‚³ãƒ³ãƒ‘ã‚¹</p>
                    <div class="bg-amber-500 text-white px-4 py-2 rounded-lg font-medium">
                        Japanese
                    </div>
                </div>
            </div>

            <!-- í”„ë‘ìŠ¤ì–´ -->
            <div class="language-option bg-white p-8 rounded-xl shadow-lg border-2 border-transparent hover:border-amber-500" onclick="goToLanguage('fr')">
                <div class="text-center">
                    <div class="text-4xl mb-4">ğŸ‡«ğŸ‡·</div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">FranÃ§ais</h3>
                    <p class="text-gray-600 text-sm mb-4">La boussole la plus fiable pour les startups</p>
                    <div class="bg-amber-500 text-white px-4 py-2 rounded-lg font-medium">
                        French
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-8">
            <p class="text-sm text-gray-500">
                Your selection will be saved for future visits
            </p>
        </div>
    </div>

    <script>
        // ì–¸ì–´ë³„ í˜ì´ì§€ ë§¤í•‘
        const languagePages = {
            'kr': 'index_kr.html',
            'en': 'index_en.html', 
            'jp': 'index_jp.html',
            'fr': 'index_fr.html'
        };

        // êµ­ê°€ë³„ ê¸°ë³¸ ì–¸ì–´ ë§¤í•‘
        const countryLanguageMap = {
            'KR': 'kr', // í•œêµ­
            'US': 'en', // ë¯¸êµ­
            'GB': 'en', // ì˜êµ­
            'CA': 'en', // ìºë‚˜ë‹¤
            'AU': 'en', // í˜¸ì£¼
            'NZ': 'en', // ë‰´ì§ˆëœë“œ
            'IE': 'en', // ì•„ì¼ëœë“œ
            'ZA': 'en', // ë‚¨ì•„í”„ë¦¬ì¹´
            'JP': 'jp', // ì¼ë³¸
            'FR': 'fr', // í”„ë‘ìŠ¤
            'BE': 'fr', // ë²¨ê¸°ì— (í”„ë‘ìŠ¤ì–´ê¶Œ)
            'CH': 'fr', // ìŠ¤ìœ„ìŠ¤ (í”„ë‘ìŠ¤ì–´ê¶Œ)
            'LU': 'fr', // ë£©ì…ˆë¶€ë¥´í¬
            'MC': 'fr', // ëª¨ë‚˜ì½”
            // ê¸°íƒ€ êµ­ê°€ëŠ” ì˜ì–´ë¥¼ ê¸°ë³¸ìœ¼ë¡œ
        };

        // ë¸Œë¼ìš°ì € ì–¸ì–´ë³„ ë§¤í•‘
        const browserLanguageMap = {
            'ko': 'kr',
            'ko-KR': 'kr',
            'en': 'en',
            'en-US': 'en',
            'en-GB': 'en',
            'ja': 'jp',
            'ja-JP': 'jp',
            'fr': 'fr',
            'fr-FR': 'fr',
            'fr-CA': 'fr'
        };

        // ì´ì „ ì–¸ì–´ ì„ íƒ í™•ì¸
        function getPreviousLanguageChoice() {
            return localStorage.getItem('mnl-preferred-language');
        }

        // ì–¸ì–´ ì„ íƒ ì €ì¥
        function saveLanguageChoice(lang) {
            localStorage.setItem('mnl-preferred-language', lang);
        }

        // ë¸Œë¼ìš°ì € ì–¸ì–´ ê°ì§€
        function detectBrowserLanguage() {
            const languages = navigator.languages || [navigator.language || navigator.userLanguage];
            
            for (let lang of languages) {
                if (browserLanguageMap[lang]) {
                    return browserLanguageMap[lang];
                }
                // ì–¸ì–´ ì½”ë“œë§Œ í™•ì¸ (ì˜ˆ: 'ko-KR' -> 'ko')
                const shortLang = lang.split('-')[0];
                if (browserLanguageMap[shortLang]) {
                    return browserLanguageMap[shortLang];
                }
            }
            return 'en'; // ê¸°ë³¸ê°’
        }

        // ì§€ì—­ ê°ì§€ (IP ê¸°ë°˜)
        async function detectLocation() {
            try {
                // ë¬´ë£Œ IP ì§€ì—­ ê°ì§€ ì„œë¹„ìŠ¤ ì‚¬ìš©
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                
                if (data.country_code && countryLanguageMap[data.country_code]) {
                    return countryLanguageMap[data.country_code];
                }
                
                return detectBrowserLanguage();
            } catch (error) {
                console.log('ìœ„ì¹˜ ê°ì§€ ì‹¤íŒ¨, ë¸Œë¼ìš°ì € ì–¸ì–´ë¡œ ëŒ€ì²´:', error);
                return detectBrowserLanguage();
            }
        }

        // ì–¸ì–´ë³„ í˜ì´ì§€ë¡œ ì´ë™
        function goToLanguage(lang) {
            if (!languagePages[lang]) {
                console.error('ì§€ì›í•˜ì§€ ì•ŠëŠ” ì–¸ì–´:', lang);
                lang = 'en'; // ê¸°ë³¸ê°’ìœ¼ë¡œ ë³€ê²½
            }
            
            saveLanguageChoice(lang);
            
            // í˜ì´ì§€ ì´ë™ ì „ ê°„ë‹¨í•œ ë¡œë”© íš¨ê³¼
            document.body.style.opacity = '0.7';
            
            setTimeout(() => {
                window.location.href = languagePages[lang];
            }, 300);
        }

        // ì–¸ì–´ ì„ íƒ í™”ë©´ í‘œì‹œ
        function showLanguageSelector() {
            document.getElementById('detecting-screen').style.display = 'none';
            document.getElementById('language-selector').classList.remove('hidden');
        }

        // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì–¸ì–´ í™•ì¸
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            if (lang && languagePages[lang]) {
                return lang;
            }
            return null;
        }

        // ë©”ì¸ ì–¸ì–´ ê°ì§€ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸ ë¡œì§
        async function initLanguageDetection() {
            // 1. URL íŒŒë¼ë¯¸í„° í™•ì¸ (ìµœìš°ì„ )
            const urlLang = getLanguageFromURL();
            if (urlLang) {
                goToLanguage(urlLang);
                return;
            }

            // 2. ì´ì „ ì„ íƒ í™•ì¸
            const previousChoice = getPreviousLanguageChoice();
            if (previousChoice && languagePages[previousChoice]) {
                goToLanguage(previousChoice);
                return;
            }

            // 3. ìœ„ì¹˜/ë¸Œë¼ìš°ì € ê¸°ë°˜ ê°ì§€
            try {
                const detectedLang = await detectLocation();
                
                // 3ì´ˆ í›„ ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ì‚¬ìš©ìê°€ ìˆ˜ë™ ì„ íƒí•  ì‹œê°„ ì œê³µ)
                setTimeout(() => {
                    // ë§Œì•½ ì‚¬ìš©ìê°€ ì´ë¯¸ ì–¸ì–´ ì„ íƒ í™”ë©´ì„ ë³´ê³  ìˆë‹¤ë©´ ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì·¨ì†Œ
                    if (document.getElementById('language-selector').classList.contains('hidden')) {
                        goToLanguage(detectedLang);
                    }
                }, 3000);
                
            } catch (error) {
                console.error('ì–¸ì–´ ê°ì§€ ì¤‘ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ì–¸ì–´ ì„ íƒ í™”ë©´ í‘œì‹œ
                setTimeout(showLanguageSelector, 2000);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì–¸ì–´ ê°ì§€ ì‹œì‘
        document.addEventListener('DOMContentLoaded', initLanguageDetection);

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì§€ì›
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                showLanguageSelector();
            }
            // ìˆ«ì í‚¤ë¡œ ë¹ ë¥¸ ì„ íƒ
            const keyMap = {
                '1': 'kr',
                '2': 'en', 
                '3': 'jp',
                '4': 'fr'
            };
            if (keyMap[e.key] && !document.getElementById('language-selector').classList.contains('hidden')) {
                goToLanguage(keyMap[e.key]);
            }
        });
    </script>
</body>
</html>
